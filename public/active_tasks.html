<!DOCTYPE html>
<html lang="tr">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Aktif GÃ¶revler</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="/css/style.css" rel="stylesheet" />
  <script src="/js/layout.js" defer></script>
</head>

<body>
  <div id="sidebar-placeholder"></div> <!-- Sidebar JS ile yÃ¼klenecek -->

  <main class="main-content">
    <h2 class="mb-4">Aktif GÃ¶revler</h2>

    <div class="table-container">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>GÃ¶rev AdÄ± Onur</th>
            <th>Cron</th>
            <th>AÃ§Ä±klama</th>
            <th>Ã‡alÄ±ÅŸma ZamanÄ±</th>
          </tr>
        </thead>
        <tbody id="taskTableBody">
          <tr>
            <td colspan="4" class="text-center">YÃ¼kleniyor...</td>
          </tr>
        </tbody>
      </table>
    </div>
  </main>

  <script>
    // Sidebar'Ä± ilk sayfadaki gibi yÃ¼kle
    fetch('/sidebar.html')
      .then(res => res.text())
      .then(html => {
        document.getElementById('sidebar-placeholder').innerHTML = html;
      })
      .catch(console.error);

    async function loadActiveTasks() {
      const res = await fetch('/api/active-tasks');
      const tbody = document.getElementById('taskTableBody');
      if (!res.ok) {
        tbody.innerHTML = '<tr><td colspan="4" class="text-center text-danger">GÃ¶revler yÃ¼klenemedi.</td></tr>';
        return;
      }
      const tasks = await res.json();
      tbody.innerHTML = '';

      if (tasks.length === 0) {
        tbody.innerHTML = '<tr><td colspan="4" class="text-center">Aktif gÃ¶rev bulunmamaktadÄ±r.</td></tr>';
        return;
      }

      tasks.forEach(task => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${formatTaskType(task.type)}</td>
          <td>${task.cron || '-'}</td>
          <td>${task.description || ''}</td>
          <td>${task.runAt ? new Date(task.runAt).toLocaleString('tr-TR') : '-'}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    function formatTaskType(type) {
      if (type === 'activate_user') return 'ðŸŸ¢ KullanÄ±cÄ±yÄ± Aktif Et';
      if (type === 'deactivate_user') return 'ðŸ›‘ KullanÄ±cÄ±yÄ± Deaktif Et';
      return type || '-';
    }

    document.addEventListener('DOMContentLoaded', () => {
      loadActiveTasks();
    });
  </script>
</body>

</html>
